<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>üß¨ Use Structured JSON Field | Camomilla</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;üìë&lt;/text&gt;&lt;/svg&gt;">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css">
    <meta name="description" content="Just playing around with flowers">
    
    <link rel="preload" href="/camomilla-core/assets/css/0.styles.7c7f7a61.css" as="style"><link rel="preload" href="/camomilla-core/assets/js/app.9615d8ef.js" as="script"><link rel="preload" href="/camomilla-core/assets/js/2.baa9ba03.js" as="script"><link rel="preload" href="/camomilla-core/assets/js/1.d97c6720.js" as="script"><link rel="preload" href="/camomilla-core/assets/js/36.0b8d3110.js" as="script"><link rel="preload" href="/camomilla-core/assets/js/7.41b60d99.js" as="script"><link rel="prefetch" href="/camomilla-core/assets/js/11.7a9fc268.js"><link rel="prefetch" href="/camomilla-core/assets/js/12.5e754b6e.js"><link rel="prefetch" href="/camomilla-core/assets/js/13.1e748f3d.js"><link rel="prefetch" href="/camomilla-core/assets/js/14.63aa1848.js"><link rel="prefetch" href="/camomilla-core/assets/js/15.b95936cd.js"><link rel="prefetch" href="/camomilla-core/assets/js/16.23bc1bd6.js"><link rel="prefetch" href="/camomilla-core/assets/js/17.65609416.js"><link rel="prefetch" href="/camomilla-core/assets/js/18.2fb21b73.js"><link rel="prefetch" href="/camomilla-core/assets/js/19.50009e1a.js"><link rel="prefetch" href="/camomilla-core/assets/js/20.6e869bca.js"><link rel="prefetch" href="/camomilla-core/assets/js/21.1ed1b4f6.js"><link rel="prefetch" href="/camomilla-core/assets/js/22.e62d9876.js"><link rel="prefetch" href="/camomilla-core/assets/js/23.8d43dc9f.js"><link rel="prefetch" href="/camomilla-core/assets/js/24.c7fa6526.js"><link rel="prefetch" href="/camomilla-core/assets/js/25.a173c535.js"><link rel="prefetch" href="/camomilla-core/assets/js/26.758b0d4d.js"><link rel="prefetch" href="/camomilla-core/assets/js/27.520ae707.js"><link rel="prefetch" href="/camomilla-core/assets/js/28.09a08435.js"><link rel="prefetch" href="/camomilla-core/assets/js/29.8c4c73f2.js"><link rel="prefetch" href="/camomilla-core/assets/js/3.280d1567.js"><link rel="prefetch" href="/camomilla-core/assets/js/30.42b51385.js"><link rel="prefetch" href="/camomilla-core/assets/js/31.a339d390.js"><link rel="prefetch" href="/camomilla-core/assets/js/32.fabe8db8.js"><link rel="prefetch" href="/camomilla-core/assets/js/33.dd23ded2.js"><link rel="prefetch" href="/camomilla-core/assets/js/34.70feaf74.js"><link rel="prefetch" href="/camomilla-core/assets/js/35.2fe7dadd.js"><link rel="prefetch" href="/camomilla-core/assets/js/37.d607d18a.js"><link rel="prefetch" href="/camomilla-core/assets/js/4.d4779f65.js"><link rel="prefetch" href="/camomilla-core/assets/js/5.5a8106f7.js"><link rel="prefetch" href="/camomilla-core/assets/js/6.3cbd9be5.js"><link rel="prefetch" href="/camomilla-core/assets/js/8.3b1bcdaf.js"><link rel="prefetch" href="/camomilla-core/assets/js/vendors~docsearch.e6747ace.js">
    <link rel="stylesheet" href="/camomilla-core/assets/css/0.styles.7c7f7a61.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/camomilla-core/" class="home-link router-link-active"><!----> <span class="site-name">Camomilla</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/camomilla-core/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/camomilla-core/How%20To/" class="nav-link">
  How to
</a></div><div class="nav-item"><a href="https://camomilla.lotrek.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/camomillacms/camomilla-core" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/camomilla-core/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/camomilla-core/How%20To/" class="nav-link">
  How to
</a></div><div class="nav-item"><a href="https://camomilla.lotrek.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/camomillacms/camomilla-core" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/camomilla-core/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/camomilla-core/How to/" class="sidebar-heading clickable open"><span>How to</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/camomilla-core/How%20to/Bootstrap%20your%20project/" class="sidebar-link">üöÄ Bootstrap your project</a></li><li><a href="/camomilla-core/How%20to/Use%20API/" class="sidebar-link">üêù Use API</a></li><li><a href="/camomilla-core/How%20to/Use%20Media/" class="sidebar-link">üñºÔ∏è Use Media</a></li><li><a href="/camomilla-core/How%20to/Use%20Menu/" class="sidebar-link">üçú Use Menu</a></li><li><a href="/camomilla-core/How%20to/Use%20Modeltranslation/" class="sidebar-link">üé≠ Use Modeltranslation</a></li><li><a href="/camomilla-core/How%20to/Use%20Pages%20Context/" class="sidebar-link">üß© Use Pages Context</a></li><li><a href="/camomilla-core/How%20to/Use%20Pages/" class="sidebar-link">üìù Use Pages</a></li><li><a href="/camomilla-core/How%20to/Use%20Settings/" class="sidebar-link">‚öôÔ∏è Use Settings</a></li><li><a href="/camomilla-core/How%20to/Use%20StructuredJSONField/" aria-current="page" class="active sidebar-link">üß¨ Use Structured JSON Field</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/camomilla-core/How%20to/Use%20StructuredJSONField/#nesting-models" class="sidebar-link">Nesting Models</a></li><li class="sidebar-sub-header"><a href="/camomilla-core/How%20to/Use%20StructuredJSONField/#list-of-structuredjsonfield" class="sidebar-link">List of StructuredJSONField</a></li><li class="sidebar-sub-header"><a href="/camomilla-core/How%20to/Use%20StructuredJSONField/#foreign-key-field" class="sidebar-link">Foreign Key Field</a></li><li class="sidebar-sub-header"><a href="/camomilla-core/How%20to/Use%20StructuredJSONField/#queryset-field" class="sidebar-link">QuerySet Field</a></li><li class="sidebar-sub-header"><a href="/camomilla-core/How%20to/Use%20StructuredJSONField/#built-in-cache-system" class="sidebar-link">Built-in cache system</a></li></ul></li></ul></section></li><li><a href="/camomilla-core/Changelog/" class="sidebar-link">CHANGELOG</a></li><li><a href="/camomilla-core/Contribute/" class="sidebar-link">How to contribute ü§ù</a></li></ul> </aside> <main class="page"> <div class="theme-succinct-content content__default"><h1 id="üß¨-use-structured-json-field"><a href="#üß¨-use-structured-json-field" class="header-anchor">#</a> üß¨ Use Structured JSON Field</h1> <h4 id="powered-by-django-structured-field"><a href="#powered-by-django-structured-field" class="header-anchor">#</a> powered by <a href="https://github.com/bnznamco/django-structured-field" target="_blank" rel="noopener noreferrer">Django Structured Field<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>The <a href="https://github.com/bnznamco/django-structured-field" target="_blank" rel="noopener noreferrer"><code>StructuredJSONField</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a special type of field that allows you to create a structured JSONField.
This kind of field allows you to declare a data structure that will be enforced to the json structure.</p> <p>To declare a data structure you need to create a class that inherits from <code>structured.pydantic.models.BaseModel</code> and declare the fields that you want to use. The Base model is a pydantic model, so you can use all the pydantic features. If you never used pydantic before, you can find the documentation <a href="https://pydantic-docs.helpmanual.io/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Let's see an example:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField

<span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    
    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">)</span>
</code></pre></div><p>In this example we created a model with a StructuredJSONField that will accept only jsons with the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you try to save a json with a different structure, the field will raise a <code>ValidationError</code>.</p> <h3 id="default-value"><a href="#default-value" class="header-anchor">#</a> Default value</h3> <p>Since the StructuredJSONField is a JSONField, you can use all the JSONField features, like the <code>default</code> parameter:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField

<span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>In this example we set a default value for the field. If you try to save a json without the <code>name</code> or <code>age</code> fields, the field will be populated with the default value.</p> <p>You can also use a generator as default value:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField

<span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">def</span> <span class="token function">default_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    
    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">,</span> default<span class="token operator">=</span>default_value<span class="token punctuation">)</span>
</code></pre></div><p>In this example we used a function as default value. The function will be called every time a new instance of the model is created.</p> <h2 id="nesting-models"><a href="#nesting-models" class="header-anchor">#</a> Nesting Models</h2> <p>Structured models can be nested. Let's see an example:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> camomilla<span class="token punctuation">.</span>structured <span class="token keyword">import</span> BaseModel

<span class="token keyword">class</span> <span class="token class-name">MyNestedModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">class</span> <span class="token class-name">MyOtherNestedModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>
    children<span class="token punctuation">:</span> MyNestedModel
    childrens<span class="token punctuation">:</span> List<span class="token punctuation">[</span>MyNestedModel<span class="token punctuation">]</span>
</code></pre></div><p>If you need to nest recursively a model, for example a model that as itself as children, you can declare the type as a string:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> camomilla<span class="token punctuation">.</span>structured <span class="token keyword">import</span> BaseModel

<span class="token keyword">class</span> <span class="token class-name">MyNestedModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>
    children<span class="token punctuation">:</span> <span class="token string">'MyNestedModel'</span>
    childrens<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token string">'MyNestedModel'</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="list-of-structuredjsonfield"><a href="#list-of-structuredjsonfield" class="header-anchor">#</a> List of StructuredJSONField</h2> <p>If you use a list as a default value, the field will adapt the schema to accept a list of the specified type:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField

<span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>

<span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="foreign-key-field"><a href="#foreign-key-field" class="header-anchor">#</a> Foreign Key Field</h2> <p>There are some special features that you can use with the StructuredJSONField.</p> <p>If you declare a field with a django model as type, the field will be populated with the instance of the model, as it was a foreign key:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>
    user<span class="token punctuation">:</span> User

</code></pre></div><p>At database level the json will store only the model primary key, but when you access the field you will get the instance of the model.
Hence we have a fully working relation inside a json field.</p> <h2 id="queryset-field"><a href="#queryset-field" class="header-anchor">#</a> QuerySet Field</h2> <p>You can also use an other special type of field: <code>camomilla.structured.QuerySet</code>. This field will store a queryset inside the json field. This is useful when you need to store a list of models. For example:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField
<span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>fields <span class="token keyword">import</span> QuerySet
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    age<span class="token punctuation">:</span> <span class="token builtin">int</span>
    users<span class="token punctuation">:</span> QuerySet<span class="token punctuation">[</span>User<span class="token punctuation">]</span>

</code></pre></div><p>In this example we declared a field that will store a list of users. The field will be populated with a queryset, so you can use all the django queryset features.
In the json structure the field will store only the primary keys of the models, ordered by the queryset order or insertion order.
When you access the django queryset, the order will be preserved. This means that you can manage queryset ordering just saving the json with data in correct order.</p> <h2 id="built-in-cache-system"><a href="#built-in-cache-system" class="header-anchor">#</a> Built-in cache system</h2> <p>Both Foreign Key and QuerySet fields can lead to performance issues. If you have a lot of instances of django models spread all over the json, the field will make several queries to the database to retrieve the related models.</p> <p>The structured field has a built-in cache system to avoid this problem üéâ.</p> <p>The cache system will analyze the json and will make only the stricly necessary queries to the database. The cache system is enabled by default, but you can disable it from camomilla settings:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># settings.py</span>

CAMOMILLA <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;STRUCTURED_FIELD&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;CACHE_ENABLED&quot;</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div style="visibility:hidden;display:none;"></div></div></div>
    <script src="/camomilla-core/assets/js/app.9615d8ef.js" defer></script><script src="/camomilla-core/assets/js/2.baa9ba03.js" defer></script><script src="/camomilla-core/assets/js/1.d97c6720.js" defer></script><script src="/camomilla-core/assets/js/36.0b8d3110.js" defer></script><script src="/camomilla-core/assets/js/7.41b60d99.js" defer></script>
  </body>
</html>
