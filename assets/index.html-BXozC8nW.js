import{_ as n,c as a,a as e,o as t}from"./app-DpFnKAEa.js";const l={};function p(i,s){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="ðŸ§¬-use-structured-json-field" tabindex="-1"><a class="header-anchor" href="#ðŸ§¬-use-structured-json-field"><span>ðŸ§¬ Use Structured JSON Field</span></a></h1><h4 id="powered-by-django-structured-field" tabindex="-1"><a class="header-anchor" href="#powered-by-django-structured-field"><span>powered by <a href="https://github.com/bnznamco/django-structured-field" target="_blank" rel="noopener noreferrer">Django Structured Field</a></span></a></h4><p>The <a href="https://github.com/bnznamco/django-structured-field" target="_blank" rel="noopener noreferrer"><code>StructuredJSONField</code></a> is a special type of field that allows you to create a structured JSONField. This kind of field allows you to declare a data structure that will be enforced to the json structure.</p><p>To declare a data structure you need to create a class that inherits from <code>structured.pydantic.models.BaseModel</code> and declare the fields that you want to use. The Base model is a pydantic model, so you can use all the pydantic features. If you never used pydantic before, you can find the documentation <a href="https://pydantic-docs.helpmanual.io/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Let&#39;s see an example:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    </span>
<span class="line">    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example we created a model with a StructuredJSONField that will accept only jsons with the following structure:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you try to save a json with a different structure, the field will raise a <code>ValidationError</code>.</p><h3 id="default-value" tabindex="-1"><a class="header-anchor" href="#default-value"><span>Default value</span></a></h3><p>Since the StructuredJSONField is a JSONField, you can use all the JSONField features, like the <code>default</code> parameter:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example we set a default value for the field. If you try to save a json without the <code>name</code> or <code>age</code> fields, the field will be populated with the default value.</p><p>You can also use a generator as default value:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">default_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>    </span>
<span class="line">    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">,</span> default<span class="token operator">=</span>default_value<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example we used a function as default value. The function will be called every time a new instance of the model is created.</p><h2 id="nesting-models" tabindex="-1"><a class="header-anchor" href="#nesting-models"><span>Nesting Models</span></a></h2><p>Structured models can be nested. Let&#39;s see an example:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> camomilla<span class="token punctuation">.</span>structured <span class="token keyword">import</span> BaseModel</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyNestedModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyOtherNestedModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line">    children<span class="token punctuation">:</span> MyNestedModel</span>
<span class="line">    childrens<span class="token punctuation">:</span> List<span class="token punctuation">[</span>MyNestedModel<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you need to nest recursively a model, for example a model that as itself as children, you can declare the type as a string:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> camomilla<span class="token punctuation">.</span>structured <span class="token keyword">import</span> BaseModel</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyNestedModel</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line">    children<span class="token punctuation">:</span> <span class="token string">&#39;MyNestedModel&#39;</span></span>
<span class="line">    childrens<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token string">&#39;MyNestedModel&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="list-of-structuredjsonfield" tabindex="-1"><a class="header-anchor" href="#list-of-structuredjsonfield"><span>List of StructuredJSONField</span></a></h2><p>If you use a list as a default value, the field will adapt the schema to accept a list of the specified type:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    structured_field <span class="token operator">=</span> StructuredJSONField<span class="token punctuation">(</span>schema<span class="token operator">=</span>MyStructuredJSONField<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="foreign-key-field" tabindex="-1"><a class="header-anchor" href="#foreign-key-field"><span>Foreign Key Field</span></a></h2><p>There are some special features that you can use with the StructuredJSONField.</p><p>If you declare a field with a django model as type, the field will be populated with the instance of the model, as it was a foreign key:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line">    user<span class="token punctuation">:</span> User</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At database level the json will store only the model primary key, but when you access the field you will get the instance of the model. Hence we have a fully working relation inside a json field.</p><h2 id="queryset-field" tabindex="-1"><a class="header-anchor" href="#queryset-field"><span>QuerySet Field</span></a></h2><p>You can also use an other special type of field: <code>camomilla.structured.QuerySet</code>. This field will store a queryset inside the json field. This is useful when you need to store a list of models. For example:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>fields <span class="token keyword">import</span> StructuredJSONField</span>
<span class="line"><span class="token keyword">from</span> structured<span class="token punctuation">.</span>pydantic<span class="token punctuation">.</span>fields <span class="token keyword">import</span> QuerySet</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyStructuredJSONField</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token builtin">int</span></span>
<span class="line">    users<span class="token punctuation">:</span> QuerySet<span class="token punctuation">[</span>User<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example we declared a field that will store a list of users. The field will be populated with a queryset, so you can use all the django queryset features. In the json structure the field will store only the primary keys of the models, ordered by the queryset order or insertion order. When you access the django queryset, the order will be preserved. This means that you can manage queryset ordering just saving the json with data in correct order.</p><h2 id="built-in-cache-system" tabindex="-1"><a class="header-anchor" href="#built-in-cache-system"><span>Built-in cache system</span></a></h2><p>Both Foreign Key and QuerySet fields can lead to performance issues. If you have a lot of instances of django models spread all over the json, the field will make several queries to the database to retrieve the related models.</p><p>The structured field has a built-in cache system to avoid this problem ðŸŽ‰.</p><p>The cache system will analyze the json and will make only the stricly necessary queries to the database. The cache system is enabled by default, but you can disable it from camomilla settings:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># settings.py</span></span>
<span class="line"></span>
<span class="line">CAMOMILLA <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;STRUCTURED_FIELD&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;CACHE_ENABLED&quot;</span><span class="token punctuation">:</span> <span class="token boolean">False</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,38)])])}const o=n(l,[["render",p]]),u=JSON.parse('{"path":"/How%20to/Use%20StructuredJSONField/","title":"ðŸ§¬ Use Structured JSON Field","lang":"en-US","frontmatter":{},"git":{"updatedTime":1732721164000,"contributors":[{"name":"bnznamco","username":"bnznamco","email":"gabriele.baldi.01@gmail.com","commits":6,"url":"https://github.com/bnznamco"},{"name":"Andrea Tuci","username":"","email":"tuci.registrazioni@gmail.com","commits":1}],"changelog":[{"hash":"332ceb7c506665c67e2c2f1945d3af0a2b3a2819","time":1732721164000,"email":"gabriele.baldi.01@gmail.com","author":"bnznamco","message":"docs: update docs for pages and structured fields"},{"hash":"df27aa27d8de5619b75daf2a6272799e996fe33d","time":1704900274000,"email":"tuci.registrazioni@gmail.com","author":"Andrea Tuci","message":"fix(typing): fixed python 3.8 typing compatibility"},{"hash":"1962b3b340c193233c4b3adcf080bb0d6f64e99f","time":1696925626000,"email":"gabriele.baldi.01@gmail.com","author":"bnznamco","message":"docs: fix StructuredJSONField documentation (wrong field name in examples)"},{"hash":"3a0018ab1371d0b8a6a7e30607bd555b48f80718","time":1694269730000,"email":"gabriele.baldi.01@gmail.com","author":"bnznamco","message":"docs: update docs"},{"hash":"8a6c0063ae005df204d16ce7747c84b9cdc68d9c","time":1694268141000,"email":"gabriele.baldi.01@gmail.com","author":"bnznamco","message":"docs: update docs"},{"hash":"fda7864b4979cf33ccaf9af256bda77f48eb82a8","time":1690803788000,"email":"gabriele.baldi.01@gmail.com","author":"bnznamco","message":"docs: update docs"},{"hash":"6dcaaf66d1dea2a89bda421c5928536ece96b9e8","time":1689849345000,"email":"gabriele.baldi.01@gmail.com","author":"bnznamco","message":"docs: update docs"}]},"filePathRelative":"How to/Use StructuredJSONField/README.md"}');export{o as comp,u as data};
